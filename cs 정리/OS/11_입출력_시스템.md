# 입출력 시스템

>  디스크 매니지먼트와 스케줄링에 대해 알아본다.

## Disk Structure

![image-20220304221658609](11_입출력_시스템.assets/image-20220304221658609.png)

- 논리적인 주소를 disk 안의 controller가 매핑
- sector 0 는 부팅을 위한 섹터

## Disk Management

![image-20220304221949187](11_입출력_시스템.assets/image-20220304221949187.png)

- ECC - 제대로 저장 되었는지 배드섹터는 아닌지, 512 bytes를 축약한 값으로 다르면 섹터가 이상한지 등을 체크
- 파티션 된 공간을 하나의 디스크로 취급, filesystem, swap용 등으로 나눠서 쓴다
- 메모리에  작은 비휘발성 메모리 ROM에 있는 기계어 즉 sector 0을 load하여 실행하라를 실행



## Disk Scheduling

![image-20220304222448122](11_입출력_시스템.assets/image-20220304222448122.png)

- Disk bandwidth(대역폭)
- 헤드의 이동거리를 줄이는 것이 가장 중요

## Disk Scheduling Algorithm

### FCFS(First Come First Served)

![image-20220304222658628](11_입출력_시스템.assets/image-20220304222658628.png)



### SSTF(Shortest Seek Time First)

![image-20220304222812026](11_입출력_시스템.assets/image-20220304222812026.png)

- starvation 문제

### SCAN

![image-20220304222910607](11_입출력_시스템.assets/image-20220304222910607.png)

- 요청에 상관없이 일정하게 끝에서 끝으로 이동하면서 처리할 수 있는 요청을 처리
- 혁신적
- 문제점 : 운 나쁘면 끝 부분이 대기시간이 중간 쯤의 부분보다 2배 기다려야한다



### C-SCAN

![image-20220304223117920](11_입출력_시스템.assets/image-20220304223117920.png)

- 대기 시간의 편차는 줄이지만 헤드의 이동이 시간이 걸린다

![image-20220304223153102](11_입출력_시스템.assets/image-20220304223153102.png)



### Other Algorithm

![image-20220304223303683](11_입출력_시스템.assets/image-20220304223303683.png)

- N-scan은 scan보다 대기시간의 편차가 준다
- 양끝에 요청이 없으면 되돌아가는 LOOK

### Disk-Scheduling Algorithm의 결정

![image-20220304223503108](11_입출력_시스템.assets/image-20220304223503108.png)



## Swap-Space Management

![image-20220304223559074](11_입출력_시스템.assets/image-20220304223559074.png)

- file system은 항상 저장되어 있어서 공간 효율성이 중요
- swap area는 컴퓨터가 켜져 있을 때만 프로세스가 살아있을 때만 중요, 공간보다는 속도 효율성 중요, 큰 단위로 연속된 섹터로 디스크 헤더가 적게 움직이고 큰 용량을 올리고 지우고



## RAID

![image-20220304223921406](11_입출력_시스템.assets/image-20220304223921406.png)

- 저렴한 디스크를 모아서 사용
- 신뢰성 향상 시 동일 정보를 중복 저장
- 최소한의 중복으로 신뢰성을 높인다
- parity(축약)해서 저장
- 병렬적 처리로 성능 향상(interleaving, striping)



# 입출력 시스템

>  Ext4 파일시스템, 저널링, 버퍼캐시 알고리즘에 대해 알아본다.

## file system

![image-20220305201921186](11_입출력_시스템.assets/image-20220305201921186.png)

![image-20220305202015795](11_입출력_시스템.assets/image-20220305202015795.png)

![image-20220305202043905](11_입출력_시스템.assets/image-20220305202043905.png)

- Ex4 가장 많이 사용



## Ext2 파일시스템

![image-20220305202140558](11_입출력_시스템.assets/image-20220305202140558.png)

- 큰 파일 지원을 위해 inderct 포인터 3개 지원

![image-20220305202231114](11_입출력_시스템.assets/image-20220305202231114.png)

- 헤드의 이동을 최소화
- 다 동일한 전체 파일시스템의 수퍼블럭을 중복 저장

![image-20220305202403275](11_입출력_시스템.assets/image-20220305202403275.png)

![image-20220305202451112](11_입출력_시스템.assets/image-20220305202451112.png)

## Ext4 파일시스템

- Ext4 = Ext2 +저널링

![image-20220305203038606](11_입출력_시스템.assets/image-20220305203038606.png)

![image-20220305203150442](11_입출력_시스템.assets/image-20220305203150442.png)

![image-20220305203306595](11_입출력_시스템.assets/image-20220305203306595.png)

### 메타데이터 저널링 모드

![image-20220305203554145](11_입출력_시스템.assets/image-20220305203554145.png)

- default로 메타데이터 저널링 모드가 되어 있다
- 구조 자체는 지킬 수 있지만 개별의 데이터는 손상이 될 수 있다

### 데이터 저널링 모드

![image-20220305203925147](11_입출력_시스템.assets/image-20220305203925147.png)

- 의미 단위로 업데이트가 완전히 되는지 아예 안 되는지
- 파일시스템과 데이터 모두 깨지지 않고 의미 있는 정보를 표시(업데이트 전 아니면 업데이트 후, 중간의 어중간한 부분이 저장 안 되게)



## 버퍼캐시 알고리즘

![image-20220305204230923](11_입출력_시스템.assets/image-20220305204230923.png)

### LRFU 알고리즘

![image-20220305204305188](11_입출력_시스템.assets/image-20220305204305188.png)

![image-20220305204519824](11_입출력_시스템.assets/image-20220305204519824.png)

- 버퍼 캐시가 n개 있으면 log(n) 안에 쫓아낼 캐시를 정할 수 있는가

![image-20220305204621497](11_입출력_시스템.assets/image-20220305204621497.png)

- t'시점에서의 값은 t에서의 값과 흐른 시간만 있으면 계산 가능
- space overhead 해결

![image-20220305204940419](11_입출력_시스템.assets/image-20220305204940419.png)

- 참조가 일어나지 않으면 value의 상대적 우위는 변하지 않는다

![image-20220305205238108](11_입출력_시스템.assets/image-20220305205238108.png)

- 시간이 흐르면서 value 자체는 변하지만 자손보다 적다는 것은 변하지 않아서 교체 시 제일 위의 값을 쫓아내고 heap을 재구성
- 다시 사용되면 value가 증가하므로 전체가 아닌 직계 자식들과 비교

![image-20220305205318055](11_입출력_시스템.assets/image-20220305205318055.png)
